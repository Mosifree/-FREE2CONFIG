# General Configuration
port: 7890
socks-port: 7891
allow-lan: false # Set to true if you want other devices in your LAN to use this proxy
mode: rule # Rule-based routing
log-level: info
external-ui: dashboard # Optional: for a web dashboard

# --- Proxies ---
proxies:
  # Example Vmess Proxy
  - name: "My_Vmess_Proxy"
    type: vmess
    server: your_vmess_server_ip_or_domain
    port: your_vmess_port
    uuid: your_vmess_uuid
    alterId: 0
    cipher: auto
    tls: true # Set to true if your Vmess uses TLS
    skip-cert-verify: true # Set to true if you're using self-signed certs
    network: ws # Example: websocket
    ws-path: "/your_ws_path" # Example: /path

  # Example SS Proxy
  - name: "My_SS_Proxy"
    type: ss
    server: your_ss_server_ip
    port: your_ss_port
    cipher: aes-256-gcm
    password: your_ss_password

# --- Proxy Groups ---
proxy-groups:
  - name: "Proxy"
    type: select
    proxies:
      - "My_Vmess_Proxy"
      - "My_SS_Proxy"
      # You can add more proxies here

  - name: "Auto Select"
    type: url-test
    url: "http://www.gstatic.com/generate_204" # Test URL for connectivity
    interval: 300 # Test every 300 seconds (5 minutes)
    proxies:
      - "My_Vmess_Proxy"
      - "My_SS_Proxy"
      # Add all your desired proxies here for auto selection

  - name: "Direct"
    type: select
    proxies:
      - DIRECT # Special keyword for direct connection

  - name: "Reject"
    type: select
    proxies:
      - REJECT # Special keyword for rejecting connection

# --- Rules ---
rules:
  # --- Rules for Iranian Traffic (Direct) ---
  - DOMAIN-SUFFIX,ir,Direct # All .ir domains
  - DOMAIN-KEYWORD,iran,Direct # Domains containing "iran"
  - DOMAIN-SUFFIX,iran,Direct
  - GEOIP,IR,Direct # All IP addresses in Iran

  # --- Rules for specific services that might need direct access or cause issues with proxy ---
  - DOMAIN-SUFFIX,iranecar.com,Direct
  - DOMAIN-AIN-SUFFIX,shaparak.ir,Direct # Payment gateways
  - DOMAIN-SUFFIX,bankmellat.ir,Direct
  - DOMAIN-SUFFIX,bankpasargad.com,Direct
  - DOMAIN-SUFFIX,bale.ir,Direct # Local messengers/services
  - DOMAIN-SUFFIX,filimo.com,Direct
  - DOMAIN-SUFFIX,namava.ir,Direct
  - DOMAIN-SUFFIX,aparat.com,Direct
  - IP-CIDR,10.0.0.0/8,Direct,no-resolve # Private IPs
  - IP-CIDR,172.16.0.0/12,Direct,no-resolve
  - IP-CIDR,192.168.0.0/16,Direct,no-resolve

  # --- Rules for bypassing certain services that are usually blocked or slow down with proxy ---
  - DOMAIN-SUFFIX,irancell.ir,Direct
  - DOMAIN-SUFFIX,mci.ir,Direct

  # --- Rules for global services that might be blocked (via Proxy) ---
  - DOMAIN-SUFFIX,google.com,Proxy
  - DOMAIN-SUFFIX,youtube.com,Proxy
  - DOMAIN-SUFFIX,whatsapp.com,Proxy
  - DOMAIN-SUFFIX,instagram.com,Proxy
  - DOMAIN-SUFFIX,twitter.com,Proxy
  - DOMAIN-SUFFIX,facebook.com,Proxy
  - DOMAIN-SUFFIX,telegram.org,Proxy
  - DOMAIN-SUFFIX,cdninstagram.com,Proxy
  - DOMAIN-SUFFIX,t.me,Proxy

  # --- Ad Blocking (Optional, uncomment to enable) ---
  # - DOMAIN-KEYWORD,ad,Reject
  # - DOMAIN-SUFFIX,googlesyndication.com,Reject
  # - DOMAIN-SUFFIX,doubleclick.net,Reject

  # --- Final Rules ---
  - GEOIP,CN,DIRECT # Example: If you don't want to proxy Chinese traffic
  - GEOIP,US,Proxy # Example: Route US traffic through proxy
  - MATCH,Proxy # All other traffic goes through the "Proxy" group by default (fallback)
